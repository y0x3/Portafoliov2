// ============================================
// DATOS HISTÃ“RICOS Y FILOSÃ“FICOS ALEATORIOS
// ============================================
export const historicalFacts = [
  {
    category: 'historia',
    fact: 'La Gran Muralla China es la Ãºnica estructura hecha por el hombre visible desde el espacio.',
    year: '200 a.C.'
  },
  {
    category: 'filosofÃ­a',
    fact: '"Pienso, luego existo" - RenÃ© Descartes. Esta frase resume el fundamento del pensamiento racional moderno.',
    author: 'RenÃ© Descartes'
  },
  {
    category: 'ciencia',
    fact: 'Isaac Newton desarrollÃ³ las leyes del movimiento mientras estaba en cuarentena durante la peste bubÃ³nica de 1665.',
    year: '1665'
  },
  {
    category: 'historia',
    fact: 'Cleopatra viviÃ³ mÃ¡s cerca de la llegada del hombre a la Luna que de la construcciÃ³n de las pirÃ¡mides de Egipto.',
    year: '30 a.C.'
  },
  {
    category: 'filosofÃ­a',
    fact: '"El hombre es la medida de todas las cosas" - ProtÃ¡goras. Fundamento del pensamiento humanista.',
    author: 'ProtÃ¡goras'
  },
  {
    category: 'ciencia',
    fact: 'Marie Curie fue la primera persona en ganar dos Premios Nobel en diferentes ciencias (FÃ­sica y QuÃ­mica).',
    year: '1903-1911'
  },
  {
    category: 'historia',
    fact: 'La imprenta de Gutenberg cambiÃ³ el mundo en 1440, democratizando el acceso al conocimiento.',
    year: '1440'
  },
  {
    category: 'filosofÃ­a',
    fact: '"Solo sÃ© que no sÃ© nada" - SÃ³crates. La sabidurÃ­a comienza reconociendo nuestra ignorancia.',
    author: 'SÃ³crates'
  },
  {
    category: 'tecnologÃ­a',
    fact: 'El primer ordenador programable, ENIAC, pesaba 27 toneladas y ocupaba una habitaciÃ³n entera.',
    year: '1945'
  },
  {
    category: 'historia',
    fact: 'Oxford University es mÃ¡s antigua que el Imperio Azteca. Oxford se fundÃ³ en 1096, los aztecas en 1325.',
    year: '1096'
  }
];

// ============================================
// SALÃ“N DE LA FAMA - FIGURAS HISTÃ“RICAS
// ============================================
export const hallOfFame = {
  scientists: [
    {
      name: 'Albert Einstein',
      field: 'FÃ­sica',
      achievement: 'TeorÃ­a de la Relatividad',
      quote: 'La imaginaciÃ³n es mÃ¡s importante que el conocimiento.',
      year: '1879-1955',
      icon: 'ğŸ§‘â€ğŸ”¬'
    },
    {
      name: 'Marie Curie',
      field: 'FÃ­sica y QuÃ­mica',
      achievement: 'Pionera en radioactividad, primera mujer en ganar un Nobel',
      quote: 'Nada en la vida debe ser temido, solamente comprendido.',
      year: '1867-1934',
      icon: 'ğŸ‘©â€ğŸ”¬'
    },
    {
      name: 'Isaac Newton',
      field: 'FÃ­sica y MatemÃ¡ticas',
      achievement: 'Leyes del movimiento y gravitaciÃ³n universal',
      quote: 'Si he visto mÃ¡s lejos es porque estoy sentado sobre los hombros de gigantes.',
      year: '1643-1727',
      icon: 'ğŸ'
    },
    {
      name: 'Nikola Tesla',
      field: 'IngenierÃ­a ElÃ©ctrica',
      achievement: 'Corriente alterna, bobina de Tesla',
      quote: 'El presente es tuyo, pero el futuro es mÃ­o.',
      year: '1856-1943',
      icon: 'âš¡'
    }
  ],
  philosophers: [
    {
      name: 'SÃ³crates',
      field: 'FilosofÃ­a',
      achievement: 'MÃ©todo socrÃ¡tico, fundamentos de la filosofÃ­a occidental',
      quote: 'Una vida sin examen no merece ser vivida.',
      year: '470-399 a.C.',
      icon: 'ğŸ¤”'
    },
    {
      name: 'PlatÃ³n',
      field: 'FilosofÃ­a',
      achievement: 'TeorÃ­a de las Ideas, fundador de la Academia',
      quote: 'La necesidad es la madre de la invenciÃ³n.',
      year: '428-348 a.C.',
      icon: 'ğŸ“š'
    },
    {
      name: 'AristÃ³teles',
      field: 'FilosofÃ­a y Ciencia',
      achievement: 'LÃ³gica, Ã©tica, polÃ­tica, biologÃ­a',
      quote: 'Somos lo que hacemos repetidamente. La excelencia, entonces, no es un acto sino un hÃ¡bito.',
      year: '384-322 a.C.',
      icon: 'ğŸ“'
    },
    {
      name: 'Confucio',
      field: 'FilosofÃ­a',
      achievement: 'Confucianismo, Ã©tica y moral',
      quote: 'Elige un trabajo que te guste y no tendrÃ¡s que trabajar ni un dÃ­a de tu vida.',
      year: '551-479 a.C.',
      icon: 'â˜¯ï¸'
    }
  ],
  artists: [
    {
      name: 'Leonardo da Vinci',
      field: 'Arte, Ciencia, IngenierÃ­a',
      achievement: 'La Mona Lisa, polÃ­mata del Renacimiento',
      quote: 'Aprender nunca cansa la mente.',
      year: '1452-1519',
      icon: 'ğŸ¨'
    },
    {
      name: 'Ludwig van Beethoven',
      field: 'MÃºsica',
      achievement: 'Novena SinfonÃ­a, transformÃ³ la mÃºsica clÃ¡sica',
      quote: 'La mÃºsica es una revelaciÃ³n mÃ¡s alta que toda sabidurÃ­a y filosofÃ­a.',
      year: '1770-1827',
      icon: 'ğŸ¼'
    },
    {
      name: 'Wolfgang Amadeus Mozart',
      field: 'MÃºsica',
      achievement: 'Prodigio musical, mÃ¡s de 600 obras',
      quote: 'La mÃºsica no estÃ¡ en las notas, sino en el silencio entre ellas.',
      year: '1756-1791',
      icon: 'ğŸµ'
    }
  ],
  leaders: [
    {
      name: 'Mahatma Gandhi',
      field: 'Activismo Social',
      achievement: 'Independencia de India mediante la no violencia',
      quote: 'SÃ© el cambio que quieres ver en el mundo.',
      year: '1869-1948',
      icon: 'ğŸ•Šï¸'
    },
    {
      name: 'Nelson Mandela',
      field: 'Derechos Humanos',
      achievement: 'Lucha contra el apartheid, presidente de SudÃ¡frica',
      quote: 'La educaciÃ³n es el arma mÃ¡s poderosa que puedes usar para cambiar el mundo.',
      year: '1918-2013',
      icon: 'âœŠ'
    },
    {
      name: 'Martin Luther King Jr.',
      field: 'Derechos Civiles',
      achievement: 'Movimiento por los derechos civiles en EE.UU.',
      quote: 'Tengo un sueÃ±o de que un dÃ­a esta naciÃ³n se levante.',
      year: '1929-1968',
      icon: 'âœ¨'
    }
  ]
};

// ============================================
// BASE DE CONOCIMIENTO PARA PREGUNTAS BÃSICAS
// ============================================
export const knowledgeBase = {
  general: {
    'Â¿quÃ© hora es?': () => {
      const now = new Date();
      return `Son las ${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
    },
    'Â¿quÃ© dÃ­a es?': () => {
      const days = ['domingo', 'lunes', 'martes', 'miÃ©rcoles', 'jueves', 'viernes', 'sÃ¡bado'];
      const now = new Date();
      return `Hoy es ${days[now.getDay()]}, ${now.getDate()}`;
    },
    'Â¿en quÃ© aÃ±o estamos?': () => {
      return `Estamos en el aÃ±o ${new Date().getFullYear()}`;
    }
  },
  math: {
    patterns: [
      /cuÃ¡nto es (\d+) \+ (\d+)/i,
      /cuÃ¡nto es (\d+) - (\d+)/i,
      /cuÃ¡nto es (\d+) \* (\d+)/i,
      /cuÃ¡nto es (\d+) \/ (\d+)/i
    ],
    calculate: (match) => {
      const num1 = parseInt(match[1]);
      const num2 = parseInt(match[2]);
      const operation = match[0].includes('+') ? '+' : 
                       match[0].includes('-') ? '-' :
                       match[0].includes('*') ? '*' : '/';
      
      let result;
      switch(operation) {
        case '+': result = num1 + num2; break;
        case '-': result = num1 - num2; break;
        case '*': result = num1 * num2; break;
        case '/': result = num2 !== 0 ? num1 / num2 : 'Error: DivisiÃ³n por cero'; break;
      }
      
      return `${num1} ${operation} ${num2} = ${result}`;
    }
  },
  definitions: {
    'quÃ© es javascript': 'JavaScript es un lenguaje de programaciÃ³n interpretado, orientado a objetos y basado en prototipos.',
    'quÃ© es html': 'HTML (HyperText Markup Language) es el lenguaje de marcado estÃ¡ndar para crear pÃ¡ginas web.',
    'quÃ© es css': 'CSS (Cascading Style Sheets) es el lenguaje usado para describir la presentaciÃ³n de documentos HTML.',
    'quÃ© es vue': 'Vue.js es un framework progresivo de JavaScript para construir interfaces de usuario.',
    'quÃ© es react': 'React es una biblioteca de JavaScript para construir interfaces de usuario, mantenida por Meta.',
    'quÃ© es python': 'Python es un lenguaje de programaciÃ³n de alto nivel, interpretado y de propÃ³sito general.',
    'quÃ© es la ia': 'La Inteligencia Artificial es la simulaciÃ³n de procesos de inteligencia humana por sistemas informÃ¡ticos.',
    'quÃ© es internet': 'Internet es una red global de computadoras interconectadas que permite el intercambio de informaciÃ³n.'
  }
};

// ============================================
// SISTEMA DE DIÃLOGOS MEJORADO
// ============================================
export const dialogSystem = {
  intents: {
    // ============================================
    // SALUDO
    // ============================================
    greeting: {
      patterns: ['hola', 'hello', 'hi', 'buenas', 'hey'],
      responses: [
        "Â¡Hola! ğŸ‘‹ Soy Clippy, tu asistente personal. Â¿En quÃ© puedo ayudarte hoy?",
        "Â¡Hey! Bienvenido. Estoy aquÃ­ para ayudarte.",
        "Â¡Hola! Â¿QuÃ© te gustarÃ­a hacer?"
      ],
      animation: 'waving',
      buttons: [
        { id: 'help', label: 'â“ Â¿QuÃ© puedes hacer?', intent: 'help_options' },
        { id: 'projects', label: 'ğŸ“‚ Ver proyectos', intent: 'projects' },
        { id: 'contact', label: 'ğŸ“§ Contactar', intent: 'contact' }
      ]
    },

    // ============================================
    // OPCIONES DE AYUDA
    // ============================================
    help_options: {
      patterns: ['ayuda', 'help', 'quÃ© puedes hacer', 'opciones'],
      responses: [
        "Puedo ayudarte con varias cosas. Â¿QuÃ© te gustarÃ­a hacer?"
      ],
      animation: 'thinking',
      buttons: [
        { id: 'show_projects', label: 'ğŸ“‚ Ver mis proyectos', intent: 'projects' },
        { id: 'show_about', label: 'ğŸ‘¤ Sobre mÃ­', intent: 'about_me' },
        { id: 'show_skills', label: 'ğŸ’¡ Mis habilidades', intent: 'skills' },
        { id: 'contact', label: 'ğŸ“§ Contactar', intent: 'contact' },
        { id: 'spotify', label: 'ğŸµ Abrir Spotify', intent: 'open_spotify' },
        { id: 'fun', label: 'ğŸ® Jugar algo', intent: 'games' },
        { id: 'learn', label: 'ğŸ“š Aprender algo nuevo', intent: 'learning_menu' }
      ]
    },

    // ============================================
    // MENÃš DE APRENDIZAJE
    // ============================================
    learning_menu: {
      patterns: ['aprender', 'conocimiento', 'historia', 'filosofÃ­a', 'cultura'],
      responses: [
        "Â¡Genial! Me encanta compartir conocimiento. Â¿QuÃ© te interesa?"
      ],
      animation: 'thinking',
      buttons: [
        { id: 'random_fact', label: 'ğŸ’¡ Dato histÃ³rico aleatorio', intent: 'random_fact' },
        { id: 'hall_of_fame', label: 'ğŸ† SalÃ³n de la Fama', intent: 'hall_of_fame_menu' },
        { id: 'ask_question', label: 'â“ Hacer una pregunta', intent: 'ask_question' },
        { id: 'back', label: 'â¬…ï¸ Volver al menÃº', intent: 'help_options' }
      ]
    },

    // ============================================
    // DATO HISTÃ“RICO ALEATORIO
    // ============================================
    random_fact: {
      patterns: ['dato', 'fact', 'curiosidad', 'cuÃ©ntame algo'],
      responses: [],
      getDynamicResponse: () => {
        const fact = historicalFacts[Math.floor(Math.random() * historicalFacts.length)];
        let response = `ğŸ“š ${fact.fact}`;
        if (fact.year) response += `\n\nğŸ“… AÃ±o: ${fact.year}`;
        if (fact.author) response += `\n\nâœï¸ ${fact.author}`;
        response += `\n\nğŸ·ï¸ CategorÃ­a: ${fact.category}`;
        return response;
      },
      animation: 'talking',
      buttons: [
        { id: 'another_fact', label: 'ğŸ”„ Otro dato', intent: 'random_fact' },
        { id: 'hall_of_fame', label: 'ğŸ† Ver personajes histÃ³ricos', intent: 'hall_of_fame_menu' },
        { id: 'back', label: 'â¬…ï¸ Volver', intent: 'learning_menu' }
      ]
    },

    // ============================================
    // SALÃ“N DE LA FAMA - MENÃš
    // ============================================
    hall_of_fame_menu: {
      patterns: ['salÃ³n de la fama', 'personajes', 'figuras histÃ³ricas'],
      responses: [
        "ğŸ† Â¡Bienvenido al SalÃ³n de la Fama! Estas son las mentes mÃ¡s brillantes de la historia. Â¿QuÃ© categorÃ­a te interesa?"
      ],
      animation: 'celebrating',
      buttons: [
        { id: 'scientists', label: 'ğŸ§‘â€ğŸ”¬ CientÃ­ficos', intent: 'hall_scientists' },
        { id: 'philosophers', label: 'ğŸ¤” FilÃ³sofos', intent: 'hall_philosophers' },
        { id: 'artists', label: 'ğŸ¨ Artistas', intent: 'hall_artists' },
        { id: 'leaders', label: 'âœŠ LÃ­deres', intent: 'hall_leaders' },
        { id: 'back', label: 'â¬…ï¸ Volver', intent: 'learning_menu' }
      ]
    },

    // ============================================
    // SALÃ“N DE LA FAMA - CIENTÃFICOS
    // ============================================
    hall_scientists: {
      patterns: ['cientÃ­ficos', 'ciencia'],
      responses: [],
      getDynamicResponse: () => {
        let response = "ğŸ§‘â€ğŸ”¬ **CIENTÃFICOS LEGENDARIOS**\n\n";
        hallOfFame.scientists.forEach(person => {
          response += `${person.icon} **${person.name}** (${person.year})\n`;
          response += `   ğŸ“Œ ${person.field}\n`;
          response += `   ğŸ† ${person.achievement}\n`;
          response += `   ğŸ’¬ "${person.quote}"\n\n`;
        });
        return response;
      },
      animation: 'talking',
      buttons: [
        { id: 'philosophers', label: 'ğŸ¤” Ver FilÃ³sofos', intent: 'hall_philosophers' },
        { id: 'artists', label: 'ğŸ¨ Ver Artistas', intent: 'hall_artists' },
        { id: 'back', label: 'â¬…ï¸ Volver', intent: 'hall_of_fame_menu' }
      ]
    },

    // ============================================
    // SALÃ“N DE LA FAMA - FILÃ“SOFOS
    // ============================================
    hall_philosophers: {
      patterns: ['filÃ³sofos', 'filosofÃ­a'],
      responses: [],
      getDynamicResponse: () => {
        let response = "ğŸ¤” **FILÃ“SOFOS LEGENDARIOS**\n\n";
        hallOfFame.philosophers.forEach(person => {
          response += `${person.icon} **${person.name}** (${person.year})\n`;
          response += `   ğŸ“Œ ${person.field}\n`;
          response += `   ğŸ† ${person.achievement}\n`;
          response += `   ğŸ’¬ "${person.quote}"\n\n`;
        });
        return response;
      },
      animation: 'talking',
      buttons: [
        { id: 'scientists', label: 'ğŸ§‘â€ğŸ”¬ Ver CientÃ­ficos', intent: 'hall_scientists' },
        { id: 'artists', label: 'ğŸ¨ Ver Artistas', intent: 'hall_artists' },
        { id: 'back', label: 'â¬…ï¸ Volver', intent: 'hall_of_fame_menu' }
      ]
    },

    // ============================================
    // SALÃ“N DE LA FAMA - ARTISTAS
    // ============================================
    hall_artists: {
      patterns: ['artistas', 'arte', 'mÃºsica'],
      responses: [],
      getDynamicResponse: () => {
        let response = "ğŸ¨ **ARTISTAS LEGENDARIOS**\n\n";
        hallOfFame.artists.forEach(person => {
          response += `${person.icon} **${person.name}** (${person.year})\n`;
          response += `   ğŸ“Œ ${person.field}\n`;
          response += `   ğŸ† ${person.achievement}\n`;
          response += `   ğŸ’¬ "${person.quote}"\n\n`;
        });
        return response;
      },
      animation: 'talking',
      buttons: [
        { id: 'scientists', label: 'ğŸ§‘â€ğŸ”¬ Ver CientÃ­ficos', intent: 'hall_scientists' },
        { id: 'leaders', label: 'âœŠ Ver LÃ­deres', intent: 'hall_leaders' },
        { id: 'back', label: 'â¬…ï¸ Volver', intent: 'hall_of_fame_menu' }
      ]
    },

    // ============================================
    // SALÃ“N DE LA FAMA - LÃDERES
    // ============================================
    hall_leaders: {
      patterns: ['lÃ­deres', 'activistas'],
      responses: [],
      getDynamicResponse: () => {
        let response = "âœŠ **LÃDERES LEGENDARIOS**\n\n";
        hallOfFame.leaders.forEach(person => {
          response += `${person.icon} **${person.name}** (${person.year})\n`;
          response += `   ğŸ“Œ ${person.field}\n`;
          response += `   ğŸ† ${person.achievement}\n`;
          response += `   ğŸ’¬ "${person.quote}"\n\n`;
        });
        return response;
      },
      animation: 'talking',
      buttons: [
        { id: 'scientists', label: 'ğŸ§‘â€ğŸ”¬ Ver CientÃ­ficos', intent: 'hall_scientists' },
        { id: 'philosophers', label: 'ğŸ¤” Ver FilÃ³sofos', intent: 'hall_philosophers' },
        { id: 'back', label: 'â¬…ï¸ Volver', intent: 'hall_of_fame_menu' }
      ]
    },

    // ============================================
    // HACER PREGUNTA
    // ============================================
    ask_question: {
      patterns: ['pregunta', 'question', 'dime', 'explica'],
      responses: [
        "Â¡Claro! Puedo responder preguntas sobre tecnologÃ­a, matemÃ¡ticas, o informaciÃ³n general. Â¿QuÃ© quieres saber?"
      ],
      animation: 'thinking',
      buttons: [
        { id: 'back', label: 'â¬…ï¸ Volver', intent: 'learning_menu' }
      ]
    },

    // ============================================
    // PROYECTOS
    // ============================================
    projects: {
      patterns: ['proyectos', 'projects', 'portafolio', 'trabajos'],
      responses: [
        "Â¡Genial! Tengo varios proyectos interesantes. Â¿CuÃ¡l te gustarÃ­a explorar?"
      ],
      animation: 'talking',
      buttons: [
        { 
          id: 'all_projects', 
          label: 'ğŸŒ Ver todos mis proyectos', 
          action: 'openWindow', 
          params: { app: 'internetexplorer' } 
        },
        { 
          id: 'github', 
          label: 'ğŸ’» Ver repositorios de GitHub', 
          action: 'openWindow', 
          params: { app: 'github' } 
        },
        { id: 'back', label: 'â¬…ï¸ Volver al menÃº', intent: 'help_options' }
      ]
    },

    // ============================================
    // SOBRE MÃ
    // ============================================
    about_me: {
      patterns: ['sobre ti', 'about', 'quien eres', 'cv', 'curriculum'],
      responses: [
        "Â¿Quieres conocer mÃ¡s sobre Diego? Te puedo mostrar su informaciÃ³n."
      ],
      animation: 'talking',
      buttons: [
        { 
          id: 'open_mypc', 
          label: 'ğŸ‘¤ Ver perfil completo', 
          action: 'openWindow', 
          params: { app: 'mycomputer' } 
        },
        { 
          id: 'open_docs', 
          label: 'ğŸ“„ Ver documentos', 
          action: 'openWindow', 
          params: { app: 'documents' } 
        },
        { id: 'back', label: 'â¬…ï¸ Volver', intent: 'help_options' }
      ]
    },

    // ============================================
    // HABILIDADES
    // ============================================
    skills: {
      patterns: ['habilidades', 'skills', 'tecnologÃ­as', 'stack'],
      responses: [
        "Diego tiene experiencia en varias tecnologÃ­as. Â¿Quieres ver su perfil completo?"
      ],
      animation: 'thinking',
      buttons: [
        { 
          id: 'open_profile', 
          label: 'ğŸ’¡ Ver habilidades completas', 
          action: 'openWindow', 
          params: { app: 'mycomputer' } 
        },
        { id: 'back', label: 'â¬…ï¸ Volver', intent: 'help_options' }
      ]
    },

    // ============================================
    // CONTACTO
    // ============================================
    contact: {
      patterns: ['contacto', 'contact', 'email', 'escribir'],
      responses: [
        "Â¿Quieres contactar con Diego? Puedo abrirte su informaciÃ³n de contacto."
      ],
      animation: 'talking',
      buttons: [
        { 
          id: 'open_outlook', 
          label: 'ğŸ“§ Abrir contactos', 
          action: 'openWindow', 
          params: { app: 'outlook' } 
        },
        { id: 'back', label: 'â¬…ï¸ Volver', intent: 'help_options' }
      ]
    },

    // ============================================
    // SPOTIFY
    // ============================================
    open_spotify: {
      patterns: ['mÃºsica', 'music', 'spotify', 'reproducir'],
      responses: [
        "Â¡Perfecto! Abriendo Spotify para ti ğŸµ",
        "Â¡Vamos a escuchar algo de mÃºsica! ğŸ¶"
      ],
      animation: 'celebrating',
      action: 'openWindow',
      params: { app: 'spotify' },
      buttons: [
        { id: 'back', label: 'â¬…ï¸ Volver al menÃº', intent: 'help_options' }
      ]
    },

    // ============================================
    // JUEGOS
    // ============================================
    games: {
      patterns: ['juego', 'game', 'jugar', 'divertir'],
      responses: [
        "Â¿Quieres jugar? Tengo Buscaminas disponible."
      ],
      animation: 'celebrating',
      buttons: [
        { 
          id: 'minesweeper', 
          label: 'ğŸ’£ Jugar Buscaminas', 
          action: 'openWindow', 
          params: { app: 'minesweeper' } 
        },
        { id: 'back', label: 'â¬…ï¸ Volver', intent: 'help_options' }
      ]
    },

    // ============================================
    // DESPEDIDA
    // ============================================
    goodbye: {
      patterns: ['adiÃ³s', 'bye', 'chao', 'hasta luego'],
      responses: [
        "Â¡Hasta luego! Si necesitas algo mÃ¡s, aquÃ­ estarÃ© ğŸ‘‹",
        "Â¡Nos vemos! No dudes en llamarme si necesitas ayuda."
      ],
      animation: 'waving',
      buttons: []
    }
  },

  // ============================================
  // PROCESADOR DE MENSAJES
  // ============================================
  processMessage(message) {
    const lowerMessage = message.toLowerCase().trim();
    
    // 1. Verificar preguntas de conocimiento general
    for (const [question, answer] of Object.entries(knowledgeBase.general)) {
      if (lowerMessage.includes(question)) {
        return {
          response: typeof answer === 'function' ? answer() : answer,
          animation: 'talking',
          buttons: [
            { id: 'another', label: 'â“ Otra pregunta', intent: 'ask_question' },
            { id: 'back', label: 'â¬…ï¸ Volver', intent: 'learning_menu' }
          ]
        };
      }
    }
    
    // 2. Verificar operaciones matemÃ¡ticas
    for (const pattern of knowledgeBase.math.patterns) {
      const match = lowerMessage.match(pattern);
      if (match) {
        return {
          response: `ğŸ”¢ ${knowledgeBase.math.calculate(match)}`,
          animation: 'thinking',
          buttons: [
            { id: 'another', label: 'ğŸ”¢ Otro cÃ¡lculo', intent: 'ask_question' },
            { id: 'back', label: 'â¬…ï¸ Volver', intent: 'learning_menu' }
          ]
        };
      }
    }
    
    // 3. Verificar definiciones
    for (const [key, definition] of Object.entries(knowledgeBase.definitions)) {
      if (lowerMessage.includes(key)) {
        return {
          response: `ğŸ“– ${definition}`,
          animation: 'talking',
          buttons: [
            { id: 'another', label: 'â“ Otra pregunta', intent: 'ask_question' },
            { id: 'back', label: 'â¬…ï¸ Volver', intent: 'learning_menu' }
          ]
        };
      }
    }
    
    // 4. Verificar intents normales
    for (const [intentName, intent] of Object.entries(this.intents)) {
      for (const pattern of intent.patterns) {
        if (lowerMessage.includes(pattern)) {
          // Si tiene getDynamicResponse, usarlo
          let response;
          if (intent.getDynamicResponse) {
            response = intent.getDynamicResponse();
          } else {
            response = Array.isArray(intent.responses)
              ? intent.responses[Math.floor(Math.random() * intent.responses.length)]
              : intent.responses;
          }
          
          return {
            response: response,
            animation: intent.animation || 'talking',
            buttons: intent.buttons || [],
            action: intent.action,
            params: intent.params
          };
        }
      }
    }
    
    // 5. Respuesta por defecto
    return {
      response: "ğŸ¤” No estoy seguro de entender. Â¿Quieres que te muestre lo que puedo hacer?",
      animation: 'thinking',
      buttons: [
        { id: 'help', label: 'â“ Ver opciones', intent: 'help_options' },
        { id: 'learn', label: 'ğŸ“š Aprender algo', intent: 'learning_menu' }
      ]
    };
  },
  
  // ============================================
  // PROCESADOR DE INTENTS (para uso directo)
  // ============================================
  getIntent(intentName) {
    const intent = this.intents[intentName];
    if (!intent) return null;
    
    // Si tiene getDynamicResponse, usarlo
    let response;
    if (intent.getDynamicResponse) {
      response = intent.getDynamicResponse();
    } else {
      response = Array.isArray(intent.responses)
        ? intent.responses[Math.floor(Math.random() * intent.responses.length)]
        : intent.responses;
    }
    
    return {
      response: response,
      animation: intent.animation || 'talking',
      buttons: intent.buttons || [],
      action: intent.action,
      params: intent.params
    };
  }
};